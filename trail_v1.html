
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <style>
    #c {
        background-color: grey;
        margin-top: 10px;
      }
      
      button {
        padding: 10px 20px;
      }
      </style>
      <script src="//cdnjs.cloudflare.com/ajax/libs/jquery/2.1.3/jquery.min.js"></script>
      <script src="./js/fabric.js"></script>
</head>
<body>
    <button id="rect">Rect</button>
    <button id="circ">Circ</button>
    <button id="save">Save</button>
    <button id="undo">undo</button>
    <button id="redo">redo</button>
    <input type="text" id="text" />
    <br> 
    <canvas id="c" width="400" height="400"></canvas>
    <br>  
    <p class="save">
    </p>

    <script src="//cdnjs.cloudflare.com/ajax/libs/crypto-js/4.2.0/crypto-js.min.js"></script>
    
    <script>
        // function calculateHash(obj) {
        //     const hash = CryptoJS.MD5(obj).toString();
        //     return hash;
        // }

        var canvas = new fabric.Canvas('c');
        canvas.setBackgroundImage('http://lorempixel.com/400/400/fashion', canvas.renderAll.bind(canvas));

        $("#text").on("click", function() {
            const text = new fabric.Text($("#text").val(), { left: 100, top: 100 });
            canvas.add(text);
        });

        $("#rect").on("click", function() {
            const rect = new fabric.Rect({
                left: 40, top: 40, width: 50, height: 50, fill: 'transparent', stroke: 'green', strokeWidth: 5
            });
            canvas.add(rect);
        });

        $("#circ").on("click", function() {
            const circle = new fabric.Circle({
                left: 40, top: 40, radius: 50, fill: 'transparent', stroke: 'green', strokeWidth: 5
            });
            canvas.add(circle);
        });

        var canvasHistory = [];
        var currentIndex = -1;
        var isUndoRedoOperation = false;

        // Function to save the current canvas state to history
        function saveToHistory() {
            if (!isUndoRedoOperation) {
                currentIndex++;
                canvasHistory[currentIndex] = JSON.stringify(canvas.toJSON());
                // Remove any future states if they exist
                canvasHistory = canvasHistory.slice(0, currentIndex + 1);
            }
        }

        // Fabric.js events to detect changes
        canvas.on('object:modified', saveToHistory);
        canvas.on('object:added', saveToHistory);

        document.getElementById("undo").addEventListener("click", undo);
        function undo() {
            if (currentIndex > 0) {
                isUndoRedoOperation = true;
                currentIndex--;
                const previousState = canvasHistory[currentIndex];
                canvas.loadFromJSON(previousState, function() {
                    canvas.renderAll();
                    isUndoRedoOperation = false;
                });
            }
        }

        document.getElementById("redo").addEventListener("click", redo);
        function redo() {
            if (currentIndex < canvasHistory.length - 1) {
                isUndoRedoOperation = true;
                currentIndex++;
                const nextState = canvasHistory[currentIndex];
                canvas.loadFromJSON(nextState, function() {
                    canvas.renderAll();
                    isUndoRedoOperation = false;
                });
            }
        }
        // Save initial state
        saveToHistory();

        document.addEventListener('keydown', function(event) {
            // Check if the Ctrl key is pressed (Ctrl key has key code 17)
            if (event.ctrlKey || event.metaKey) {
                // Check for Ctrl+Z (undo) on Windows or Command+Z on Mac
                if ((event.key === 'z' || event.key === 'Z') && !event.shiftKey) {
                    event.preventDefault(); // Prevent the browser's default Ctrl+Z or Command+Z behavior
                    undo(); // Call the undo function
                }
                // Check for Ctrl+R (redo) on Windows or Command+R on Mac
                else if ((event.key === 'r' || event.key === 'R') && !event.shiftKey) {
                    event.preventDefault(); // Prevent the browser's default Ctrl+R or Command+R behavior
                    redo(); // Call the redo function
                }
            }
        });

// Sample data points
// var dataPoints = [
//     { x: 10, y: 50 }, 
//     { x: 50, y: 30 },
//     { x: 90, y: 70 },
//     // Add more points as needed
// ];

// // Function to draw a line between two points
// function drawLine(point1, point2) {
//     var line = new fabric.Line([point1.x, point1.y, point2.x, point2.y], {
//         fill: 'black',
//         stroke: 'black',
//         strokeWidth: 2,
//     });
//     canvas.add(line);
// }

// // Draw the line plot
// for (var i = 0; i < dataPoints.length - 1; i++) {
//     drawLine(dataPoints[i], dataPoints[i + 1]);
// }
    </script>
</body>
</html>

<!-- reference -->
<!-- https://codepen.io/ryjkmr/pen/KKWgVVP -->