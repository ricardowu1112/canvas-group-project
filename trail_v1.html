
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <style>
    #c {
        background-color: grey;
        margin-top: 10px;
      }
      
      button {
        padding: 10px 20px;
      }
      </style>
      <script src="//cdnjs.cloudflare.com/ajax/libs/jquery/2.1.3/jquery.min.js"></script>
      <script src="./js/fabric.js"></script>
      <style>
        .context-menu
        {
        border-radius: 8px;
        height: 20px;
        box-shadow: 0 0 30px rgba(0, 0, 0, 0.54);
        position: absolute;
        background-color: white;
        /*   backdrop-filter: blur(10px); */
        /*   -webkit-backdrop-filter: blur(10px); */
        
        /* that's for the pen : */
        display: none;
        z-index: 10000 !important;
        /*   transform: translate(-50%, -50%); */
            
        /* 
        but normally it's just :
        display: none;
        */
        }

        .button-container{
        display:flex;
        flex-direction: row;
        justify-content: center;
        align-items: center;
        height:100%;
        }
        .btn
        {
        border: none;
        background-color: transparent;
        width: 100%;
        font-size: 0.5em;
        font-family: "Quicksand", sans-serif;
        font-weight: 800;
        letter-spacing: 0.004em;
        color: #e8e8e8;
        cursor: pointer;
        transition: background-color 0.2s;
        display: flex;
        justify-content:center;
        align-items: center;
        height: 100%;
        }
        .btn p
        {
        width: 100%;
        height: 100%;
        text-align: left;
        transition: background-color 0.15s;
        border-radius: 3px;
        display: flex;
        align-items: center;
        padding: 0 0px;
        color: black;
        margin: 3px;
        font-size: 6px;
        }
        .btn:hover div
        {
        background-color: rgba(147, 147, 147, 0.31);
        }
        #blue
        {
        padding : 0px 0;
        }
        #green
        {
        padding : 0px 0;
        }
        #orange {
        padding : 0px 0;
        }
        .vertical {
        border: 1px solid black;
        height: 80%
        }
      </style>
</head>
<body>
    <div style="display: flex; flex-direction: column;">
        <div style="display: flex;justify-content: center;">
            <button id="rect">Rect</button>
            <button id="circ">Circ</button>
            <button id="save">Save</button>
            <button id="undo">undo</button>
            <button id="redo">redo</button>
            <button id="clear">clear</button>
            <p class="save"></p>
            <input type="text" id="text" />
        </div>
        <div style="display: flex;justify-content: center;">
            <canvas id="c" width="800" height="600"></canvas>
        </div>
    </div>

    <div class="context-menu">
        <div class="button-container">
          <button class="btn" id="blue" onClick="changeBackground(id)"><p>Blue</p></button>
          <div class="vertical"></div>
          <button class="btn" id="orange" onClick="changeBackground(id)"><p>Orange</p></button>
          <div class="vertical"></div>
          <button class="btn" id="green" onClick="changeBackground(id)"><p>Green</p></button>
        </div>
      </div>
      <script src="//cdnjs.cloudflare.com/ajax/libs/crypto-js/4.2.0/crypto-js.min.js"></script>
      <!-- <script>
            
            const orange = document.querySelector("#orange");
            const blue = document.querySelector("#blue");
            const green = document.querySelector("#green");


            document.addEventListener('DOMContentLoaded', (event) => {
                const menu = document.querySelector(".context-menu");
                const canvaswall = document.querySelector("#c");
                canvaswall.addEventListener("contextmenu", function(e) {
                    // Show the context menu
                menu.style.display = "block";
                
                // just for the pen :
                menu.style.transform = "translate(0)";
                
                // set position X of the menu
                if ((window.innerWidth - e.clientX) > menu.offsetWidth + 10){
                    menu.style.left = e.clientX + "px";
                }
                else
                {
                    menu.style.left = (e.clientX - menu.offsetWidth) + "px";
                }
                // set position Y of the menu
                if ((e.clientY) > menu.offsetHeight + 10){   
                menu.style.top = (e.clientY - menu.offsetHeight) + "px";
                }
                else
                {
                    menu.style.top = e.clientY + "px";
                }
                })

                //exit the context menu
                window.addEventListener("click", function(){
                    menu.style.display = "none";
                })
            });
    
            
            
      </script> -->
 
    <script>
        // function calculateHash(obj) {
        //     const hash = CryptoJS.MD5(obj).toString();
        //     return hash;
        // }

        var canvasHistory = [];
        var currentIndex = -1;
        var isUndoRedoOperation = false;
        var historySizeLimit = 20; // Set the maximum size of the history

        var canvas = new fabric.Canvas('c',{
            fireRightClick: true,
            stopContextMenu: true});
        
        //     Disable default right-click context menu
        document.addEventListener('DOMContentLoaded', function() {
            window.addEventListener('contextmenu', function(e) {
                e.preventDefault();
            });
        });

        canvas.setBackgroundImage('http://lorempixel.com/400/400/fashion', canvas.renderAll.bind(canvas));

        $("#text").on("click", function() {
            const text = new fabric.Text($("#text").val(), { left: 100, top: 100 });
            canvas.add(text);
        });

        $("#rect").on("click", function() {
            const rect = new fabric.Rect({
                left: 40, top: 40, width: 50, height: 50, fill: 'transparent', stroke: 'green', strokeWidth: 5
            });
            canvas.add(rect);
        });

        $("#circ").on("click", function() {
            const circle = new fabric.Circle({
                left: 40, top: 40, radius: 50, fill: 'transparent', stroke: 'green', strokeWidth: 5
            });
            canvas.add(circle);
        });


        // Function to save the current canvas state to history
        function saveToHistory() {
            if (!isUndoRedoOperation) {
                // Remove any future states if they exist
                canvasHistory = canvasHistory.slice(0, currentIndex + 1);
                currentIndex++;
                canvasHistory[currentIndex] = JSON.stringify(canvas.toJSON());
                // Drop the oldest states until the history size is within the limit
                while (canvasHistory.length > historySizeLimit) {
                    canvasHistory.shift();
                    currentIndex--;
                    if (currentIndex < 0) {
                        currentIndex = 0; // Ensures currentIndex doesn't go below 0
                    }
                }
            }
        }

        // Fabric.js events to detect changes
        canvas.on('object:modified', saveToHistory);
        canvas.on('object:added', saveToHistory);
        canvas.on('mouse:down', function(options) {
    if (options.e.button === 2 || options.e.which === 3) { // Right-click
        console.log("Right-click");
        options.e.preventDefault();
        const menu = document.querySelector(".context-menu");

        // Show the context menu
        menu.style.display = "block";

        // Calculate position of the menu based on the mouse event and menu size
        const menuWidth = menu.offsetWidth;
        const menuHeight = menu.offsetHeight;
        const clientX = options.e.clientX;
        const clientY = options.e.clientY;

        // Adjust position if the menu goes beyond the right edge of the window
        if (clientX + menuWidth > window.innerWidth) {
            menu.style.left = (window.innerWidth - menuWidth) + "px";
        } else {
            menu.style.left = clientX + "px";
        }

        // Adjust position if the menu goes beyond the bottom edge of the window
        if (clientY + menuHeight > window.innerHeight) {
            menu.style.top = (window.innerHeight - menuHeight) + "px";
        } else {
            menu.style.top = clientY + "px";
        }

        // Exit the context menu on window click
        window.addEventListener("click", function() {
            menu.style.display = "none";
        });
        return false;
    }
});


        document.getElementById("undo").addEventListener("click", undo);
        function undo() {
            if (currentIndex > 0) {
                isUndoRedoOperation = true;
                currentIndex--;
                const previousState = canvasHistory[currentIndex];
                canvas.loadFromJSON(previousState, function() {
                    canvas.renderAll();
                    isUndoRedoOperation = false;
                });
            }
        }

        document.getElementById("redo").addEventListener("click", redo);
        function redo() {
            if (currentIndex < canvasHistory.length - 1) {
                isUndoRedoOperation = true;
                currentIndex++;
                const nextState = canvasHistory[currentIndex];
                canvas.loadFromJSON(nextState, function() {
                    canvas.renderAll();
                    isUndoRedoOperation = false;
                });
            }
        }

        document.getElementById("clear").addEventListener("click", function () {
            canvas.clear();
            saveToHistory();
        });


        // Save initial state
        saveToHistory();

        document.addEventListener('keydown', function(event) {
            // Check if the Ctrl key is pressed (Ctrl key has key code 17)
            if (event.ctrlKey || event.metaKey) {
                // Check for Ctrl+Z (undo) on Windows or Command+Z on Mac
                if ((event.key === 'z' || event.key === 'Z') && !event.shiftKey) {
                    event.preventDefault(); // Prevent the browser's default Ctrl+Z or Command+Z behavior
                    undo(); // Call the undo function
                }
                // Check for Ctrl+R (redo) on Windows or Command+R on Mac
                else if ((event.key === 'r' || event.key === 'R') && !event.shiftKey) {
                    event.preventDefault(); // Prevent the browser's default Ctrl+R or Command+R behavior
                    redo(); // Call the redo function
                }
            }
        });


        // Function to remove the selected object
        function removeSelectedObject() {
            var activeObject = canvas.getActiveObject();
            if (activeObject) {
                canvas.remove(activeObject);
                saveToHistory();
            }
        }

        // Binding the Backspace key to remove the selected object
        document.addEventListener('keydown', function(event) {
            if (event.key === 'Backspace' || event.key === 'Delete') {
                event.preventDefault(); // Prevent the default backspace action
                removeSelectedObject();
            }
        });


        $("#save").on("click", function(e) {
                    $(".save").html(canvas.toSVG());
        });

// Sample data points
var dataPoints = [
    { x: 10, y: 50 }, 
    { x: 50, y: 30 },
    { x: 90, y: 70 },
    // Add more points as needed
];

// Function to draw a line between two points
function drawLine(point1, point2) {
    var line = new fabric.Line([point1.x, point1.y, point2.x, point2.y], {
        fill: 'black',
        stroke: 'black',
        strokeWidth: 2,
    });
    canvas.add(line);
}

// Draw the line plot
for (var i = 0; i < dataPoints.length - 1; i++) {
    drawLine(dataPoints[i], dataPoints[i + 1]);
}
    </script>
</body>
</html>

<!-- reference -->
<!-- https://codepen.io/ryjkmr/pen/KKWgVVP -->