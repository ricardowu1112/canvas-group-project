<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Floating Layout with Tailwind CSS</title>
    <!-- <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.0.0/dist/css/bootstrap.min.css" integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm" crossorigin="anonymous">
    <script src="https://code.jquery.com/jquery-3.2.1.slim.min.js" integrity="sha384-KJ3o2DKtIkvYIK3UENzmM7KCkRr/rE9/Qpg6aAZGJwFDMVNA/GpGFF93hXpG5KkN" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/popper.js@1.12.9/dist/umd/popper.min.js" integrity="sha384-ApNbgh9B+Y1QKtv3Rn7W3mgPxhU9K/ScQsAP7hUibX39j7fakFPskvXusvfa0b4Q" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.0.0/dist/js/bootstrap.min.js" integrity="sha384-JZR6Spejh4U02d8jOt6vLEHfe/JQGiRRSQQxSfFWpi1MquVdAyjUar5+76PVCmYl" crossorigin="anonymous"></script> -->
    <script src="https://cdn.tailwindcss.com"></script>
    <Script src="//cdnjs.cloudflare.com/ajax/libs/jquery/2.1.3/jquery.min.js"></script>
        <!-- Flowbite -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/flowbite/2.2.0/flowbite.min.css" rel="stylesheet" />
    <script src="https://cdnjs.cloudflare.com/ajax/libs/flowbite/2.2.0/flowbite.min.js"></script>
    <!--  -->
        <script src="./js/fabric.js"></script>
    <style>
        *, *::before, *::after {
            box-sizing: border-box;
        }

        body {
            max-width: 100vw; /* Set maximum width */
            max-height: 100vh; /* Set maximum height */
            margin-left: auto;
            margin-right: auto;
            overflow: auto; /* Add scroll if content overflows */
        }


        body.light-theme {
        background-color: #e6ecf1;
        color: #1a202c;
        }
body.light-theme nav, body.light-theme aside, body.light-theme main {
  background-color: #3f6cec;
}
body.light-theme .hover-bg {
  background-color: black;
}

body:not(.light-theme) {
  background-color: #171719;
  color: #f7fafc;
}
body:not(.light-theme) nav, body:not(.light-theme) aside, body:not(.light-theme) main {
  background-color: rgba(18, 19, 22, 0.95);
}
body:not(.light-theme) .hover-bg {
  background-color: #2589ff;
}

@media (prefers-color-scheme: light) {
  body {
    background-color: #e6ecf1;
    color: #1a202c;
  }
  body nav, body aside, body main {
    background-color: #3f6cec;
  }
  body .hover-bg {
    background-color: black;
  }
}
#canvas-container {
    max-width: calc(100% - 500px);
    margin-left: auto;
    margin-right: auto;
    position: relative;
    display: flex;
    justify-content: center;
}

/* @media (max-width: 768px) {
    #canvas-container {
        max-width: 100%;
        margin-left: 20px;
        margin-right: 20px;
    }
} */

/* Responsive canvas */
#c {
    width: 100%;
    height: auto;
    background-color: #2d2e32;
}


.nav-container {
  position: relative;
  display: flex;
  /* Other styling */
}

.nav-link {
  position: relative;
  overflow: hidden;
  padding: 10px;
  z-index: 1;
  /* Maintain z-index */
  /* Other existing styles */
}

.hover-bg {
  position: absolute;
  top: 5px;
  left: 5px;
  right: 5px;
  bottom: 5px;
  background: #2589ff;
  /* Color for hover background */
  border-radius: 5px;
  /* Pill shape */
  transform: scale(0, 0);
  /* Initially scaled down uniformly in both X and Y */
  transform-origin: center;
  /* Scaling from the center */
  transition: transform 0.3s ease;
  /* Smooth transition for scaling */
  pointer-events: none;
  z-index: -1;
  /* Place behind the text */
}

.nav-link:hover .hover-bg {
  transform: scale(1, 1);
  /* Scale up uniformly in both X and Y on hover */
}
    </style>
    <style>
        button {
        padding: 10px 20px;
        }
        .context-menu {
            /* opacity: 0.7; */
            background: #282828;
            position: absolute;
            top:-140%;
            left: -25%;
            border-radius: 5px;
            /* font: 16px; */
            height: 20px;
            /* box-shadow: 0 0 30px rgba(0, 0, 0, 0.01); */
            z-index: 10000 !important;
            display: none;
        }
        /* tooltip  after
        .context-menu::after {
            content: " ";
            width: 0;
            height: 0;
            border-style: solid;
            border-width: 10px 10px 0 10px;
            border-color: #282828 transparent transparent transparent;
            opacity: 1;
            position: absolute;
            left: 40%;
        } */


        .button-container{
            display:flex;
            flex-direction: row;
            justify-content: center;
            align-items: center;
            height:100%;
            padding:0px 0.5px;
        }
        .btn
        {
            border: none;
            background-color: transparent;
            width: 100%;
            font-size: 0.5em;
            font-family: "Quicksand", sans-serif;
            font-weight: 600;
            color: #e8e8e8;
            letter-spacing: 0.1em;
            cursor: pointer;
            transition: background-color 0.2s;
            display: flex;
            justify-content:center;
            align-items: center;
            height: 100%;
            padding: 0%;
        }
        .btn:hover{
            border-radius: 5px;
            background-color: rgb(219, 213, 213, 0.3);
        }
        .btn p
        {
            width: 100%;
            height: 100%;
            text-align: left;
            transition: background-color 0.15s;
            border-radius: 3px;
            display: flex;
            align-items: center;
            padding: 0px;
            color: white;
            margin: 3px;
            font-size: 6px;
        }
        .btn:hover div
        {
        background-color: rgba(147, 147, 147, 0.31);
        }
        #blue
        {
        padding : 0px 0;
        }
        #green
        {
        padding : 0px 0;
        }
        #orange {
        padding : 0px 0;
        }
        .vertical {
        border: 1px solid #4d4d4d;
        height: 80%
        }

 .tooltip-carousel {
  position: relative;
  display: inline-flex;
  justify-content: center;
  align-items: center;
  user-select: none;
  padding: 0px 8px;
  background: #d5d5d5;
  border-radius: 18px;
  box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
  height:11px;
}

.tooltip-carousel-content {
  display: flex;
  align-items: center;
  transition: transform 0.3s ease-in-out;
  white-space: nowrap;
}

.tooltip-carousel-item {
  padding: 3px 5px;
  cursor: pointer;
  margin: 0px 0px;
  white-space: nowrap;
  font-size: x-small;
}

.tooltip-carousel-item:hover {
  background: #b1b0b0;
  border-radius: 10px;
}


.carousel-divider {
  height: 24.5px;
  border: 1px solid #ccc;
  margin: 0px 5px;
}

.prev, .next {
  position: absolute;
  top: 50%;
  transform: translateY(-50%);
  cursor: pointer;
  z-index: 5;
}

.prev {
  left: 10px;
}

.next {
  right: 10px;
}

.tooltip-arrow {
  position: absolute;
  bottom: -9.5px;
  left: 50%;
  width: 0;
  height: 0;
  border-left: 10px solid transparent;
  border-right: 10px solid transparent;
  border-top: 10px solid #d5d5d5;
  transform: translateX(-50%);
}

.dropbtn {
  border: none;
  cursor: pointer;
}


/* The container <div> - needed to position the dropdown content */
.dropdown {
  position: absolute;
  left:-50%;
  display: inline-block;
  top: 110%;
}

/* Dropdown Content (Hidden by Default) */
.dropdown-content {
    display: none;
    flex-direction: column;
    justify-content: center;
    align-items: center;
    position: fixed;
    padding:5px;
    background-color: #121316;
    /* min-width: 100px; */
    box-shadow: 0px 8px 16px 0px rgba(0,0,0,0.2);
    z-index: 1;
    left:79px;
    top: 120%; /* Position it below the button */
    box-shadow: 0 0 0 1px rgba(255, 255, 255, 0.05); 
  backdrop-filter: blur(32px);
  border-radius: 16px;
}

/* Links inside the dropdown */
.dropdown-content div {
  color: white;
  padding: 10px 10px;
  text-decoration: none;
  display: block;
  cursor: pointer;
}


/* Change color of dropdown links on hover */
.dropdown-content div:hover {background-color: #2589ff;border-radius: 16px;}


/* Show the dropdown menu (use JS to add this class to the .dropdown-content container when the user clicks on the dropdown button) */
.show {display:flex;}

._separator_wcxgk_99 {
    width: 4px;
    height: 16px;
    background-color: rgba(255, 255, 255, .05);
    margin: 0 6px;
    border-radius: 2px;
    padding: 2px;
}

.prevent-select {
  -webkit-user-select: none; /* Safari */
  -ms-user-select: none; /* IE 10 and IE 11 */
  user-select: none; /* Standard syntax */
}

.login-button {
    border-radius: 16px;
    cursor: pointer;
}
.login-button:active {
    background: #2589ff;
    border-radius: 16px;
}
.login-button:hover {
    background: #2589ff;
    border-radius: 16px;
}

      </style>
      <style>
        #drop-overlay {
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        width: 100%;
        background: rgba(255, 255, 255, 0.3);
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 24px;
        color: #000;
        border: 2px dashed #000;
        pointer-events: none; /* Allows mouse events to pass through */
        }
        #drop-overlay img {
            max-width: 100px; /* Adjust size as needed */
        }
      </style>
        <script>
    /* When the user clicks on the button, 
    toggle between hiding and showing the dropdown content */
    function createBtn() {
      document.getElementById("myDropdown").classList.toggle("show");
    }
    
    // Close the dropdown if the user clicks outside of it
    window.onclick = function(event) {
      if (!event.target.matches('.dropbtn')) {
        var dropdowns = document.getElementsByClassName("dropdown-content");
        var i;
        for (i = 0; i < dropdowns.length; i++) {
          var openDropdown = dropdowns[i];
          if (openDropdown.classList.contains('show')) {
            openDropdown.classList.remove('show');
          }
        }
      }
    }
    </script>
</head>
<body class="bg-[#171719] text-gray-200 overflow-hidden">

<!-- Floating Navbar -->
<div class="fixed top-4 left-1/2 transform -translate-x-1/2 z-50">
    <nav class="bg-[rgba(18,19,22,0.95)] shadow-xl rounded-[16px] px-5 py-0" style="border: 1px solid white;">
        <div class="flex items-center justify-between">
            <div class="text-white text-lg mr-5">Logo</div>
                <div class="text-white text-sm nav-link rounded-[16px] flex items-center justify-center" style="cursor: pointer;">
                    <div>
                        <svg onclick="createBtn()" class="dropbtn" width="16" height="16" viewBox="0 0 16 16"  fill="none" xmlns="http://www.w3.org/2000/svg" >
                            <path d="M7.5 2V13M2 7.5H13" stroke="white" stroke-linecap="round"></path>
                        </svg>
                        <span class="hover-bg"></span>
                        <div class="dropdown">
                            <div id="myDropdown" class="dropdown-content">
                                <div id="drawing-mode" class="my-1" drawing="false">
                                    <svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M1.50022 6.5C1.50022 6.5 5.17294 -3.49999 8.00022 8C10.8275 19.5 14.5 9.49998 14.5 9.49998" stroke="currentColor" stroke-linecap="round"></path><path d="M3 6.5C3 7.32843 2.32843 8 1.5 8C0.671573 8 0 7.32843 0 6.5C0 5.67157 0.671573 5 1.5 5C2.32843 5 3 5.67157 3 6.5Z" fill="currentColor"></path><path d="M16 9.5C16 10.3284 15.3284 11 14.5 11C13.6716 11 13 10.3284 13 9.5C13 8.67157 13.6716 8 14.5 8C15.3284 8 16 8.67157 16 9.5Z" fill="currentColor"></path></svg>
                                </div>
                                <div id="rect">
                                    <svg width="16" height="16" viewBox="0 0 16 16" xmlns="http://www.w3.org/2000/svg" class="_typeIcon_12syx_29" color="white"><rect stroke="currentColor" x="1.5" y="1.5" width="13" height="13" rx="2" fill="none" fill-rule="evenodd"></rect></svg>
                                </div>
                                <div id="circ"> 
                                    <svg width="16" height="16" viewBox="0 0 16 16" xmlns="http://www.w3.org/2000/svg" class="_typeIcon_12syx_29" color="white"><circle stroke="currentColor" cx="8" cy="8" r="6.5" fill="none" fill-rule="evenodd"></circle></svg>
                                </div>
                                <div id="add-text">
                                    <svg width="16" height="16" viewBox="0 0 16 16" xmlns="http://www.w3.org/2000/svg" class="_typeIcon_12syx_29" color="white"><path d="M8 3v11.5a.5.5 0 11-1 0V3H1.5a.5.5 0 010-1h12a.5.5 0 110 1H8z" fill="currentColor" fill-rule="evenodd"></path></svg>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div data-orientation="vertical" aria-orientation="vertical" role="separator" class="_separator_wcxgk_99"></div>

                <div class="text-white text-sm nav-link rounded-[16px] flex items-center justify-center" style="cursor: pointer;" id="select-mode">
                    <div>
                        <svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M6 14.5L2 2L14.5 6.5L8 8.5L6 14.5Z" stroke="white" stroke-linejoin="round"></path></svg>
                        <span class="hover-bg" id="create-hover-bg"></span>
                    </div>
                </div>

                <div data-orientation="vertical" aria-orientation="vertical" role="separator" class="_separator_wcxgk_99"></div>

                <div class="text-white text-sm nav-link rounded-[16px] flex items-center justify-center" style="cursor: pointer;" id="undo">
                    <div>
                        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24">
                            <path d="M17.026 22.957c10.957-11.421-2.326-20.865-10.384-13.309l2.464 2.352h-9.106v-8.947l2.232 2.229c14.794-13.203 31.51 7.051 14.794 17.675z" fill="white"/>
                          </svg>
                        <span class="hover-bg"></span>
                    </div>
                </div>
                <div class="text-white text-sm nav-link rounded-[16px] flex items-center justify-center" style="cursor: pointer;" id="redo">
                    <div>
                        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24">
                            <path d="M17.026 22.957c10.957-11.421-2.326-20.865-10.384-13.309l2.464 2.352h-9.106v-8.947l2.232 2.229c14.794-13.203 31.51 7.051 14.794 17.675z" fill="white" transform="scale(-1, 1) translate(-24, 0)"/>
                          </svg>
                        <span class="hover-bg"></span>
                    </div>
                </div>
                <div class="text-white text-sm nav-link rounded-[16px] flex items-center justify-center" style="cursor: pointer;" id="clear">
                    <div>
                        <svg style="color: white" xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-trash" viewBox="0 0 16 16"> <path d="M5.5 5.5A.5.5 0 0 1 6 6v6a.5.5 0 0 1-1 0V6a.5.5 0 0 1 .5-.5zm2.5 0a.5.5 0 0 1 .5.5v6a.5.5 0 0 1-1 0V6a.5.5 0 0 1 .5-.5zm3 .5a.5.5 0 0 0-1 0v6a.5.5 0 0 0 1 0V6z" fill="white"></path> <path fill-rule="evenodd" d="M14.5 3a1 1 0 0 1-1 1H13v9a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V4h-.5a1 1 0 0 1-1-1V2a1 1 0 0 1 1-1H6a1 1 0 0 1 1-1h2a1 1 0 0 1 1 1h3.5a1 1 0 0 1 1 1v1zM4.118 4 4 4.059V13a1 1 0 0 0 1 1h6a1 1 0 0 0 1-1V4.059L11.882 4H4.118zM2.5 3V2h11v1h-11z" fill="white"></path> </svg>
                        <span class="hover-bg"></span>
                    </div>
                </div>

            <div data-orientation="vertical" aria-orientation="vertical" role="separator" class="_separator_wcxgk_99"></div>
            <div class="flex nav-container">
            <!-- <a href="#" class="text-white text-sm nav-link rounded-[16px] prevent-select">
                <span class="hover-bg"></span> 
                About
            </a>
            <a href="#" class="text-white text-sm nav-link rounded-[16px] prevent-select">
                <span class="hover-bg"></span> 
                Contact
            </a> -->
            <a id="save" class="text-white text-sm nav-link rounded-[16px] prevent-select" style="cursor: pointer;">
                <span class="hover-bg"></span>
                Save</a>
        </div>
            <div class="flex space-x-4" style="padding: 5px;">
              <div id="theme-toggle" style="position: relative; cursor: pointer;padding: 5px;">
                <svg id="sun" class="sun-icon" aria-hidden="true" width="24" height="24" viewBox="0 0 24 24">
                    <circle class="sun" cx="12" cy="12" r="6" mask="url(#moon-mask)" fill="currentColor"></circle>
                    <g class="sun-beams" stroke="currentColor">
                        <line x1="12" y1="1" x2="12" y2="3"></line>
                        <line x1="12" y1="21" x2="12" y2="23"></line>
                        <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
                        <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
                        <line x1="1" y1="12" x2="3" y2="12"></line>
                        <line x1="21" y1="12" x2="23" y2="12"></line>
                        <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
                        <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
                    </g>
                    <mask class="moon" id="moon-mask">
                        <rect x="0" y="0" width="100%" height="100%" fill="white"></rect>
                        <!-- <circle cx="24" cy="10" r="6" fill="black" /> -->
                        <circle cx="5" cy="17" r="" fill="black"></circle>
                        <!-- <circle cx="7" cy="18" r="3" fill="black" /> -->
                    </mask>
                    </svg>  
                <svg id="moon" class="moon-icon" aria-hidden="true" width="24" height="24" viewBox="0 0 24 24" style="display: none; transform: rotate(70deg);"><mask id="mask"><rect x="0" y="0" width="100%" height="100%" fill="white"></rect><circle cx="12" cy="4" r="9" fill="black"></circle></mask><circle fill="white" cx="12" cy="12" r="9" mask="url(#mask)"></circle></svg>
            </div>
            </div>
            <div>
<!--               <button id="theme-toggle" class="text-white text-sm">Theme</button> -->
                <a class="text-white text-sm prevent-select login-button" id="login-text" data-modal-target="authentication-modal" data-modal-toggle="authentication-modal" type="button" style="padding: 5px;">Login</a>
                <!-- <button data-modal-target="authentication-modal" data-modal-toggle="authentication-modal" class="block text-white bg-blue-700 hover:bg-blue-800 focus:ring-4 focus:outline-none focus:ring-blue-300 font-medium rounded-lg text-sm px-5 py-2.5 text-center dark:bg-blue-600 dark:hover:bg-blue-700 dark:focus:ring-blue-800" type="button"> -->
                    <!-- Toggle modal -->
                  <!-- </button> -->
                <a class="text-white text-sm prevent-select login-button" id="logout-text" data-modal-target="authentication-modal" data-modal-toggle="authentication-modal" type="button" style="padding: 5px; display: none;">Logout</a>
                  
                <a id="register-text" onclick="logOut()" class="text-white text-sm prevent-select login-button" style="padding: 5px;" data-modal-target="register-modal" data-modal-toggle="register-modal" type="button">Register</a>
            </div>
        </div>
    </nav>

</div>
<!-- Main modal -->
<script>
        const loginText = document.getElementById('login-text');
        const logoutText = document.getElementById('logout-text');
        const registerText = document.getElementById('register-text');
        async function handleLoginClick() {
            const apiUrl = 'http://127.0.0.1:5000/customer/login'; // Replace with your API URL 52.184.80.174
            const apiUrlGet = 'http://127.0.0.1:5000/customer/auth/drawings'; // Replace with your API URL 52.184.80.174
            const usernameLogin = document.getElementById('username-login').value;
            const passwordLogin = document.getElementById('password-login').value;
            try {
                const response = await fetch(apiUrl, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                        // Include other headers as required
                    },
                    body: JSON.stringify({
                        username: usernameLogin, // Replace with actual data
                        password: passwordLogin  // Replace with actual data
                    }),
                    credentials: 'include'
                });
                if (response.ok) {
                        const data = await response.json();
                        
                        const accessToken = await response.headers.get('Authorization');
                        if (accessToken) {
                        // You now have the access token, and you can store it or use it as needed
                        console.log('Access Token:', accessToken);
                        } else {
                        console.error('No access token found in the response headers.');
                        }

                        console.log('Login successful', data);
                        var modal = document.getElementById('authentication-modal');
                        modal.classList.add('hidden');
                        loginText.style.display = "none";
                        registerText.style.display = "none";
                        logoutText.style.display = "block";
                        
                        

                        await fetch(apiUrlGet, {
                                method: 'GET',
                                headers: {
                                    'Authorization': `${accessToken}`,
                                    'Content-Type': 'application/json'
                                    // Add any other headers as needed
                                },
                                })
                                .then((response) => {
                                    if (response.ok) {
                                    // Handle the successful response
                                    return response.json(); // Or parse the response as needed
                                    } else {
                                    // Handle error responses
                                    console.error('Error:', response.status, response.statusText);
                                    }
                                })
                                .then((data) => {
                                    // Handle the response data here
                                    console.log('Response Data:', data);
                                })
                                .catch((error) => {
                                    console.error('Fetch error:', error);
                                });
                        
                } else {
                    console.log('Login failed');
                    // Handle errors or unsuccessful login here
                }
            } catch (error) {
                console.error('Error during API call', error);
            }
        }

        async function handleRegisterClick() {
            const apiUrl = 'http://127.0.0.1:5000/register'; // Replace with your API URL 52.184.80.174
            
            const usernameRegister = document.getElementById('username-register').value;
            const passwordRegister = document.getElementById('password-register').value;

            try {
                const response = await fetch(apiUrl, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                        // Include other headers as required
                    },
                    body: JSON.stringify({
                        username: usernameRegister, // Replace with actual data
                        password: passwordRegister  // Replace with actual data
                    })
                });

                if (response.ok) {
                        const data = await response.json();
                        console.log('Signup successful', data);
                        var modal = document.getElementById('register-modal');
                        modal.classList.add('hidden');
                        loginText.style.display = "none";
                        logoutText.style.display = "block";
                        registerText.style.display = "none";
                        


                } else {
                    console.log('Register failed');
                    // Handle errors or unsuccessful login here
                }
            } catch (error) {
                console.error('Error during API call', error);
            }
        }

        function logOut(){

            loginText.style.display = "block";
            logoutText.style.display = "none";
            registerText.style.display = "block";
            localStorage.clear();
        }
            

</script>
                  <div id="authentication-modal" tabindex="-1" aria-hidden="true" class="hidden overflow-y-auto overflow-x-hidden fixed top-0 right-0 left-0 z-50 justify-center items-center w-full md:inset-0 h-[calc(100%-1rem)] max-h-full">
                      <div class="relative p-4 w-full max-w-md max-h-full">
                          <!-- Modal content -->
                          <div class="relative bg-white rounded-lg shadow dark:bg-gray-700">
                              <!-- Modal header -->
                              <div class="flex items-center justify-between p-4 md:p-5 border-b rounded-t dark:border-gray-600">
                                  <h3 class="text-xl font-semibold text-gray-900 dark:text-white">
                                      Sign in to our platform
                                  </h3>
                                  <button type="button" class="end-2.5 text-gray-400 bg-transparent hover:bg-gray-200 hover:text-gray-900 rounded-lg text-sm w-8 h-8 ms-auto inline-flex justify-center items-center dark:hover:bg-gray-600 dark:hover:text-white" data-modal-hide="authentication-modal">
                                      <svg class="w-3 h-3" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 14 14">
                                          <path stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="m1 1 6 6m0 0 6 6M7 7l6-6M7 7l-6 6"/>
                                      </svg>
                                      <span class="sr-only">Close modal</span>
                                  </button>
                              </div>
                              <!-- Modal body -->
                              <div class="p-4 md:p-5">
                                  <form class="space-y-4" action="#">
                                      <div>
                                          <label for="username" class="block mb-2 text-sm font-medium text-gray-900 dark:text-white">Your username</label>
                                          <input type="text" name="username" id="username-login" class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 block w-full p-2.5 dark:bg-gray-600 dark:border-gray-500 dark:placeholder-gray-400 dark:text-white" placeholder="username" required>
                                      </div>
                                      <div>
                                          <label for="password" class="block mb-2 text-sm font-medium text-gray-900 dark:text-white">Your password</label>
                                          <input type="password" name="password" id="password-login" placeholder="••••••••" class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 block w-full p-2.5 dark:bg-gray-600 dark:border-gray-500 dark:placeholder-gray-400 dark:text-white" required>
                                      </div>
                                      <div class="flex justify-between">
                                          <!-- <div class="flex items-start">
                                              <div class="flex items-center h-5">
                                                  <input id="remember" type="checkbox" value="" class="w-4 h-4 border border-gray-300 rounded bg-gray-50 focus:ring-3 focus:ring-blue-300 dark:bg-gray-600 dark:border-gray-500 dark:focus:ring-blue-600 dark:ring-offset-gray-800 dark:focus:ring-offset-gray-800" required>
                                              </div>
                                              <label for="remember" class="ms-2 text-sm font-medium text-gray-900 dark:text-gray-300">Remember me</label>
                                          </div>
                                          <a href="#" class="text-sm text-blue-700 hover:underline dark:text-blue-500">Lost Password?</a> -->
                                      </div>
                                      <button type="submit" onclick="handleLoginClick()" class="w-full text-white bg-blue-700 hover:bg-blue-800 focus:ring-4 focus:outline-none focus:ring-blue-300 font-medium rounded-lg text-sm px-5 py-2.5 text-center dark:bg-blue-600 dark:hover:bg-blue-700 dark:focus:ring-blue-800">Login to your account</button>
                                      <div class="text-sm font-medium text-gray-500 dark:text-gray-300">
                                          Not registered? <a href="#" class="text-blue-700 hover:underline dark:text-blue-500" data-modal-target="register-modal" data-modal-toggle="register-modal" data-modal-hide="authentication-modal" type="button">Create account</a>
                                      </div>
                                  </form>
                              </div>
                          </div>
                      </div>
                  </div> 
                  <div id="register-modal" tabindex="-1" aria-hidden="true" class="hidden overflow-y-auto overflow-x-hidden fixed top-0 right-0 left-0 z-50 justify-center items-center w-full md:inset-0 h-[calc(100%-1rem)] max-h-full">
                    <div class="relative p-4 w-full max-w-md max-h-full">
                        <!-- Modal content -->
                        <div class="relative bg-white rounded-lg shadow dark:bg-gray-700">
                            <!-- Modal header -->
                            <div class="flex items-center justify-between p-4 md:p-5 border-b rounded-t dark:border-gray-600">
                                <h3 class="text-xl font-semibold text-gray-900 dark:text-white">
                                    Sign up to our platform
                                </h3>
                                <button type="button" class="end-2.5 text-gray-400 bg-transparent hover:bg-gray-200 hover:text-gray-900 rounded-lg text-sm w-8 h-8 ms-auto inline-flex justify-center items-center dark:hover:bg-gray-600 dark:hover:text-white" data-modal-hide="register-modal">
                                    <svg class="w-3 h-3" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 14 14">
                                        <path stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="m1 1 6 6m0 0 6 6M7 7l6-6M7 7l-6 6"/>
                                    </svg>
                                    <span class="sr-only">Close modal</span>
                                </button>
                            </div>
                            <!-- Modal body -->
                            <div class="p-4 md:p-5">
                                <form class="space-y-4" action="#">
                                    <div>
                                        <label for="username" class="block mb-2 text-sm font-medium text-gray-900 dark:text-white">Your email</label>
                                        <input type="text" name="username" id="username-register" class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 block w-full p-2.5 dark:bg-gray-600 dark:border-gray-500 dark:placeholder-gray-400 dark:text-white" placeholder="username" required>
                                    </div>
                                    <div>
                                        <label for="password" class="block mb-2 text-sm font-medium text-gray-900 dark:text-white">Your password</label>
                                        <input type="password" name="password" id="password-register" placeholder="••••••••" class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 block w-full p-2.5 dark:bg-gray-600 dark:border-gray-500 dark:placeholder-gray-400 dark:text-white" required>
                                    </div>

                                    <button type="submit" onclick="handleRegisterClick()" class="w-full text-white bg-blue-700 hover:bg-blue-800 focus:ring-4 focus:outline-none focus:ring-blue-300 font-medium rounded-lg text-sm px-5 py-2.5 text-center dark:bg-blue-600 dark:hover:bg-blue-700 dark:focus:ring-blue-800">Sign up </button>
                                    <div class="text-sm font-medium text-gray-500 dark:text-gray-300">
                                        Have registered? <a href="#" class="text-blue-700 hover:underline dark:text-blue-500" data-modal-target="authentication-modal" data-modal-toggle="authentication-modal" data-modal-hide="register-modal">Login account</a>
                                    </div>
                                </form>
                            </div>
                        </div>
                    </div>
                </div> 
<!-- Main content area with sidebars -->
<div class="flex h-screen pt-16"> <!-- h-screen to set total height to be 100vh -->

    <!-- Left Sidebar -->
    <aside class="w-[230px] bg-[rgba(18,19,22,0.95)] fixed top-4 left-0 ml-4 rounded-2xl shadow-2xl" style="height: calc(100vh - 2rem); bottom: 2rem; border: 1px solid white;">
        <!-- <div class="pt-10 space-y-2">
            <a href="#" class="flex justify-center items-center py-2 px-4 text-white text-sm hover:bg-gray-700 rounded">Dashboard</a>
            <a href="#" class="flex justify-center items-center py-2 px-4 text-white text-sm hover:bg-gray-700 rounded">Settings</a>
            <a href="#" class="flex justify-center items-center py-2 px-4 text-white text-sm hover:bg-gray-700 rounded">Profile</a>
        </div> -->
    
        <div style="display: flex; flex-direction: column; align-items: center; margin-top: 20px;">
            <!-- <button id="rect" class="my-1">Rect</button>
            <button id="circ" class="my-1">Circ</button> -->

            <button id="move-to-front" class="my-1">Move to Front</button>
            <button id="move-up" class="my-1">Move Up</button>
            <button id="move-to-bottom" class="my-1">Move to Bottom</button>
            <button id="move-down" class="my-1">Move Down</button>
            
            <!-- <div class="my-1">
                <input type="text" id="text" class="text-sm rounded text-gray-800" />
            </div> -->
            <p class="save my-1"></p>
        </div>
    </aside>

    <!-- Right Sidebar -->
    <aside class="w-[230px] bg-[rgba(18,19,22,0.95)] fixed top-4 right-0 mr-4 rounded-2xl shadow-2xl" style="height: calc(100vh - 2rem); bottom: 2rem; display: flex; flex-direction: column; align-items: center;border: 1px solid white;">
        <div class="pt-10 space-y-2 w-full text-center">
            <a href="#" class="block py-2 px-4 text-white text-sm hover:bg-gray-700 rounded">Help</a>
            <a href="#" class="block py-2 px-4 text-white text-sm hover:bg-gray-700 rounded">Support</a>
            <a href="#" class="block py-2 px-4 text-white text-sm hover:bg-gray-700 rounded">FAQ</a>
        </div>
        
        <div style="display: inline-block; margin-top: 20px; width: 100%;">
            <div id="drawing-mode-options" style="text-align: center;">
                <label for="drawing-mode-selector" class="">Mode:</label>
                <select id="drawing-mode-selector" class="text-gray-900">
                    <option>Pencil</option>
                    <option>Circle</option>
                    <option>Spray</option>
                </select><br>
            
                <label for="drawing-line-width">Line width:</label>
                <span class="info">5</span><input type="range" value="5" min="0" max="150" id="drawing-line-width"><br>
            
                <label for="drawing-color">Line color:</label>
                <input type="color" value="#005E7A" id="drawing-color"><br>
            
                <label for="drawing-shadow-color">Shadow color:</label>
                <input type="color" value="#005E7A" id="drawing-shadow-color"><br>
            
                <label for="drawing-shadow-width">Shadow width:</label>
                <span class="info">0</span><input type="range" value="0" min="0" max="50" id="drawing-shadow-width"><br>
            
                <label for="drawing-shadow-offset">Shadow offset:</label>
                <span class="info">0</span><input type="range" value="0" min="0" max="50" id="drawing-shadow-offset"><br>
            </div>
        </div>
    </aside>

    <!-- Main Content -->
<!--     <main class="flex-1 mx-auto px-4 py-0 bg-gray-900 my-4" style="max-width: 60%; background:Red"> -->

        <div id="canvas-container" style="position: relative !important;display: flex; justify-content: center;align-items: center;max-width: 100%;">
            <div style="width: 100%;position: relative;">
            <canvas id="c" style="z-index: 5 !important;" width=900 height=900></canvas>
                <div id="drop-overlay" style="display: none;z-index: 9;">
                    <img src="./img/upload-icon.svg" alt="Drop icon" /> <!-- Drop icon -->
                </div>
            <div id="tooltip" style="display: none; position: absolute; background-color: #fff; padding: 5px; border: 1px solid #000;"></div>
            </div>
        </div>



    <div class="context-menu" id="context-menu" style="z-index: 6 !important;position: fixed;color:black">
        <div style="position:absolute;"> <!-- Change position to relative here -->
            <div class="tooltip-carousel"  style="height:auto">
                <div class="tooltip-carousel-content" id="carouselContent" style="height: 100%;width: auto !important;">
                <!-- Dynamic content will be loaded here -->
                </div>

            </div>
            <div class="tooltip-arrow"></div> <!-- Tooltip 'nib' -->
        </div>
  </div>

  <script>
    document.addEventListener('DOMContentLoaded', function() {
    var dropdownItems = document.querySelectorAll('.dropdown-content div');
    var createBtn = document.getElementById('create-btn');

    dropdownItems.forEach(function(item) {
        item.addEventListener('click', function() {
            // Add 'active' class to createBtn
            createBtn.classList.add('active');
        });
    });
});
  </script>
<script src="json2.js"></script>
<script>
    function copyObjectHandler() {
        $('#context-menu').hide();
    pastetext.style.display = "flex";
    canvas.getActiveObject().clone(function(cloned) {
    _clipboard = cloned;
    updatePasteButtonVisibility();
    // console.log(_clipboard);
    })
    }
    
    function pasteObjectHandler(e) {
            $('#context-menu').hide();
                console.log(_clipboard);
                _clipboard.clone(function(clonedObj) {
                    canvas.discardActiveObject();
                    var pointer = canvas.getPointer(e);  // Transform the mouse coordinates
                    clonedObj.set({
                        left: pointer.x,
                        top: pointer.y,
                        evented: true,
                    });
                    if (clonedObj.type === 'activeSelection') {
                        // active selection needs a reference to the canvas.
                        clonedObj.canvas = canvas;
                        clonedObj.forEachObject(function(obj) {
                            canvas.add(obj);
                        });
                        // this should solve the unselectability
                        clonedObj.setCoords();
                    } else {
                        canvas.add(clonedObj);
                    }
                    _clipboard.top += 10;
                    _clipboard.left += 10;
                    canvas.setActiveObject(clonedObj);
                    canvas.requestRenderAll();
                });
                updatePasteButtonVisibility();
    }
    
    function updatePasteButtonVisibility() {
        let pasteButton = document.getElementById('paste');
        if (_clipboard) {
            pasteButton.style.display = "flex";
        } else {
            pasteButton.style.display = "none";
        }
    }
    
    
    
    let _clipboard;
    document.addEventListener('keydown', function(event) {
      if (event.ctrlKey || event.metaKey) { // Check for Ctrl key (Windows) or Command key (Mac)
        if (event.key === 'c') {
            copyObjectHandler();
        } else if (event.key === 'v') {
            if (_clipboard) {
        // clone again, so you can do multiple copies.
        _clipboard.clone(function(clonedObj) {
            canvas.discardActiveObject();
            clonedObj.set({
                left: clonedObj.left + 10,
                top: clonedObj.top + 10,
                evented: true,
            });
            if (clonedObj.type === 'activeSelection') {
                // active selection needs a reference to the canvas.
                clonedObj.canvas = canvas;
                clonedObj.forEachObject(function(obj) {
                    canvas.add(obj);
                });
                // this should solve the unselectability
                clonedObj.setCoords();
            } else {
                canvas.add(clonedObj);
            }
            _clipboard.top += 10;
            _clipboard.left += 10;
            canvas.setActiveObject(clonedObj);
            canvas.requestRenderAll();
        });
        }
         else {
            console.log('No object has been copied');
        }
        }
      }
    });
    
    
    let carouselData = [
      [
        { value: 'Group', id: 'group', handler: () => {} },
        { value: 'Copy', id: 'copy', handler: copyObjectHandler},
        { value: 'Paste', id: 'paste', handler: pasteObjectHandler},
        { value: 'Delete',id: 'delete', handler: () => {
            $('#context-menu').hide();
            var activeObject = canvas.getActiveObject();
            if (activeObject) {
                // Check if the selection is a group of objects
                if (activeObject.type === 'activeSelection') {
                    activeObject.forEachObject(function(obj) {
                        canvas.remove(obj);
                    });
                    // Deselect the group after removing its objects
                    canvas.discardActiveObject();
                } else {
                    // If it's a single object, just remove it
                    canvas.remove(activeObject);
                }
                canvas.requestRenderAll();
                saveToHistory();
            }
        }}
      ],
      [
        { value: 4, handler: () => console.log('4 clicked') },
        { value: 5, handler: () => console.log('5 clicked') },
        { value: 6, handler: () => console.log('6 clicked') }
      ],
      [
        { value: 7, handler: () => console.log('7 clicked') },
        { value: 8, handler: () => console.log('8 clicked') }
      ]
    ];
    
    
    let menuIndex = 0;
    
    function updateCarousel() {
      const carouselContent = document.querySelector('.tooltip-carousel-content');
      carouselContent.innerHTML = '';
    
      let slideData = [...carouselData[menuIndex]];
    
      if (menuIndex > 0) slideData.unshift({ value: '<', handler: () => navigate(-1) });
      if (menuIndex < carouselData.length - 1) slideData.push({ value: '>', handler: () => navigate(1) });
    
      slideData.forEach((itemData) => {
        if (itemData.value === '<' || itemData.value === '>') {
            itemData.handler = (event) => navigate(itemData.value === '>' ? 1 : -1, event);
        }
        createCarouselItem(itemData, carouselContent);
    });
    
    //   adjustCarouselWidth();
    }
    
    function createCarouselItem(itemData, carouselContent) {
        let div = document.createElement('div');
        div.className = 'tooltip-carousel-item';
        div.textContent = itemData.value;
        if (itemData.id) {
            div.id = itemData.id; // Assign the id
        }
        div.addEventListener('click', itemData.handler);
        carouselContent.appendChild(div);
    }
    
    function addDivider(carouselContent) {
      let divider = document.createElement('div');
      divider.className = 'carousel-divider';
      carouselContent.appendChild(divider);
    }
    
    function navigate(direction, event) {
        if (event) {
            event.stopPropagation(); // Prevent the click from being propagated
        }
        
        if (menuIndex + direction >= 0 && menuIndex + direction < carouselData.length) {
            menuIndex += direction;
            updateCarousel();
            updatePasteButtonVisibility(); // Update the visibility of the paste button
            checkGroupedObjects()
        }
    }
    
    // function adjustCarouselWidth() {
    //   const carouselContent = document.querySelector('.tooltip-carousel-content');
    //   let totalWidth = 0;
    //   Array.from(carouselContent.children).forEach(child => {
    //     const style = window.getComputedStyle(child);
    //     const margin = parseInt(style.marginLeft) + parseInt(style.marginRight);
    
    //     totalWidth += child.offsetWidth + margin;
    //   });
    
    //   carouselContent.style.width = `${totalWidth}px`;
    // }
    
    // Initialize the carousel
    updateCarousel();

    // drag and drop
    const canvasContainer = document.getElementById('canvas-container');
    const dropOverlay = document.getElementById('drop-overlay');

    canvasContainer.addEventListener('dragover', function (e) {
        e.preventDefault();
        dropOverlay.style.display = 'flex'; // Show overlay
    });

    canvasContainer.addEventListener('dragleave', function (e) {
        e.preventDefault();
        dropOverlay.style.display = 'none'; // Hide overlay
    });

    canvasContainer.addEventListener('drop', function (e) {
        e.preventDefault();
        dropOverlay.style.display = 'none'; // Hide overlay on drop

        // Process the dropped file (as before)
    });
    document.addEventListener('dragover', function (e) {
            e.preventDefault(); // Prevent default behavior for dragover
        }, false);

        document.getElementById('canvas-container').addEventListener('drop', function (e) {
    e.preventDefault();
    dropOverlay.style.display = 'none'; // Hide the overlay

    if (e.dataTransfer.files.length > 0) {
        var file = e.dataTransfer.files[0];
        var reader = new FileReader();

        reader.onload = function (event) {
            fabric.Image.fromURL(event.target.result, function (img) {
                // Get mouse position relative to the canvas
                var pointer = canvas.getPointer(e);
                var posX = pointer.x;
                var posY = pointer.y;

                // Set the image position
                img.set({
                    left: posX,
                    top: posY,
                    originX: 'center',
                    originY: 'center'
                });

                // Optionally, scale the image if it's too large
                var maxDimension = Math.max(img.width, img.height);
                var maxCanvasDimension = Math.min(canvas.getWidth(), canvas.getHeight());
                if (maxDimension > maxCanvasDimension) {
                    var scaleRatio = maxCanvasDimension / maxDimension;
                    img.scale(scaleRatio);
                }

                // Add the image to the canvas
                canvas.add(img).renderAll();
            });
        };
        reader.readAsDataURL(file);
    }
});
    // drag and drop

    // move beyond and below
// Move selected object to front
document.getElementById('move-to-front').addEventListener('click', function() {
    var activeObject = canvas.getActiveObject();
    if (activeObject) {
        canvas.bringToFront(activeObject);
        canvas.renderAll(); // Force a render update
        saveToHistory()
    }
});


// Move selected object up
document.getElementById('move-up').addEventListener('click', function() {
    var activeObject = canvas.getActiveObject();
    if (activeObject) {
        canvas.bringForward(activeObject);
        canvas.renderAll(); // Update the canvas immediately
        saveToHistory()
    }
});

// Move selected object to bottom
document.getElementById('move-to-bottom').addEventListener('click', function() {
    var activeObject = canvas.getActiveObject();
    if (activeObject) {
        canvas.sendToBack(activeObject);
        canvas.renderAll(); // Update the canvas immediately
        saveToHistory()
    }
});

// Move selected object down
document.getElementById('move-down').addEventListener('click', function() {
    var activeObject = canvas.getActiveObject();
    if (activeObject) {
        canvas.sendBackwards(activeObject);
        canvas.renderAll(); // Update the canvas immediately
        saveToHistory()
    }
});

// move beyond and below


        </script>
        <script>
    document.getElementById('select-mode').onclick = function() { toggleDrawingMode('select'); };



    let isGrouped;
// Initialization and setup

// try {
//   var jsonData = JSON.parse(localStorage.getItem('historyArray')); // Replace with your actual JSON data
//   // Use jsonData as needed
// } catch (error) {
//   console.error("Error parsing JSON:", error);
// }
// var currentIndex = -1;

var isUndoRedoOperation = false;
var historySizeLimit = 20; // Set the maximum size of the history
var drawingModeEl = document.getElementById('drawing-mode');
var isDrawing = drawingModeEl.getAttribute('drawing');

var drawingOptionsEl = document.getElementById('drawing-mode-options');
var drawingColorEl = document.getElementById('drawing-color');
var drawingShadowColorEl = document.getElementById('drawing-shadow-color');
var drawingLineWidthEl = document.getElementById('drawing-line-width');
var drawingShadowWidth = document.getElementById('drawing-shadow-width');
var drawingShadowOffset = document.getElementById('drawing-shadow-offset');
var canvas = new fabric.Canvas('c', {
    fireRightClick: true,
    stopContextMenu: true,
    isDrawingMode: !isDrawing,
    preserveObjectStacking: true,
});

fabric.Object.prototype.cornerSize = 8; // Adjust the size as needed
fabric.Object.prototype.transparentCorners = false;

$(document).bind('contextmenu', function(e) {
    e.preventDefault();
});

let pastetext = document.querySelector("#paste");

// New global variables for drawing modes
let isDrawingRectangleMode = false;
let isDrawingCircleMode = false;
let currentShape; // Current drawing shape (rectangle or circle)
let startX, startY; // Starting point coordinates
let tooltip; // Tooltip for dimensions display

// Initialize free drawing settings (but do not set it as active)
function initializeFreeDrawing() {
    var brush = new fabric.PencilBrush(canvas);
    brush.color = drawingColorEl.value;
    brush.width = parseInt(drawingLineWidthEl.value, 10) || 1;
    brush.shadow = new fabric.Shadow({
        blur: parseInt(drawingShadowWidth.value, 10) || 0,
        offsetX: parseInt(drawingShadowOffset.value, 10) || 0,
        offsetY: parseInt(drawingShadowOffset.value, 10) || 0,
        affectStroke: true,
        color: drawingShadowColorEl.value,
    });
    return brush;
}
// Assign the initialized brush to the canvas (without enabling drawing mode)
canvas.freeDrawingBrush = initializeFreeDrawing();

// Function to toggle drawing mode
function toggleDrawingMode(mode) {
    // Check if free drawing mode is already active
    if (mode === 'free' && canvas.isDrawingMode) {
        canvas.isDrawingMode = false;
        canvas.defaultCursor = 'default';
        return; // Exit the function early
    }

    // Reset all drawing modes
    isDrawingRectangleMode = false;
    isDrawingCircleMode = false;
    canvas.isDrawingMode = false;
    canvas.defaultCursor = 'default'; // Reset cursor to default

    // Additional logic based on the mode
    switch (mode) {
        case 'rectangle':
            isDrawingRectangleMode = true;
            canvas.defaultCursor = 'crosshair';
            break;
        case 'circle':
            isDrawingCircleMode = true;
            canvas.defaultCursor = 'crosshair';
            break;
        case 'free':
            canvas.isDrawingMode = true;
            break;
        case 'select':
            // No additional actions needed for select mode
            break;
    }
}


// Event listeners for drawing mode buttons
document.getElementById('rect').onclick = function() { toggleDrawingMode('rectangle'); };
document.getElementById('circ').onclick = function() { toggleDrawingMode('circle'); };
drawingModeEl.onclick = function() { toggleDrawingMode('free'); };

canvas.on("mouse:down", function(e) {
    if (isDrawingRectangleMode || isDrawingCircleMode) {
        const pointer = canvas.getPointer(e.e);
        const currentColor = drawingColorEl.value; // Get the current selected color

        startX = pointer.x;
        startY = pointer.y;
        currentShape = isDrawingRectangleMode ? new fabric.Rect({
            left: startX,
            top: startY,
            width: 0,
            height: 0,
            fill: 'transparent',
            stroke: currentColor, // Use the selected color
            strokeWidth: 5
        }) : new fabric.Circle({
            left: startX,
            top: startY,
            radius: 0,
            fill: 'transparent',
            stroke: currentColor, // Use the selected color
            strokeWidth: 5,
            originX: 'center',
            originY: 'center'
        });

        canvas.add(currentShape);

    }
});

// Mouse move event for updating shapes
canvas.on("mouse:move", function(e) {
    if ((isDrawingRectangleMode || isDrawingCircleMode) && currentShape) {
        const pointer = canvas.getPointer(e.e);

        if (isDrawingRectangleMode) {
            let width = pointer.x - startX;
            let height = pointer.y - startY;
            currentShape.set({
                left: width > 0 ? startX : pointer.x,
                top: height > 0 ? startY : pointer.y,
                width: Math.abs(width),
                height: Math.abs(height)
            });
        } else if (isDrawingCircleMode) {
            let radius = Math.sqrt(Math.pow(pointer.x - startX, 2) + Math.pow(pointer.y - startY, 2));
            currentShape.set({ radius: radius });
        }

        currentShape.setCoords();
        canvas.renderAll();
        updateTooltip(e.e.clientX, e.e.clientY, currentShape);
    }
});

// Function to update the tooltip
function updateTooltip(x, y, shape) {
    // Create tooltip if it doesn't exist
    if (!tooltip) {
        tooltip = document.createElement("div");
        tooltip.id = "tooltip";
        tooltip.style.position = "fixed";
        tooltip.style.backgroundColor = "black";
        tooltip.style.padding = "5px";
        tooltip.style.border = "1px solid black";
        tooltip.style.zIndex = "12";
        document.body.appendChild(tooltip);
    }

    // Display tooltip with dimensions
    tooltip.style.display = "block";
    tooltip.style.left = (x + 10) + "px";
    tooltip.style.top = (y + 10) + "px";

    if (isDrawingRectangleMode) {
        let width = Math.round(shape.width);
        let height = Math.round(shape.height);
        tooltip.textContent = `Width: ${width}, Height: ${height}`;
    } else if (isDrawingCircleMode) {
        let radius = Math.round(shape.radius);
        tooltip.textContent = `Radius: ${radius}`;
    }
}

// Mouse up event to finalize shape drawing
canvas.on("mouse:up", function() {
    if (isDrawingRectangleMode && currentShape) {
        isDrawingRectangleMode = false; // Reset drawing mode
        canvas.defaultCursor = 'default'; // Reset cursor to default
        tooltip.style.display = "none"; // Hide the tooltip
        currentShape = null; // Reset currentShape for the next drawing
    } else if (isDrawingCircleMode && currentShape) {
        isDrawingCircleMode = false; // Reset drawing mode
        canvas.defaultCursor = 'default'; // Reset cursor to default
        tooltip.style.display = "none"; // Hide the tooltip
        currentShape = null; // Reset currentShape for the next drawing
    }
    console.log(canvasHistory)
});

// Additional code for free drawing brush configuration
let drawingModeSelector = document.getElementById('drawing-mode-selector');
drawingModeSelector.onchange = function() {
    let isDrawingTool = ['Pencil', 'Circle', 'Spray'].includes(this.value);

    if (isDrawingTool) {
        canvas.isDrawingMode = true;
        canvas.freeDrawingBrush = new fabric[this.value + 'Brush'](canvas);
        canvas.freeDrawingBrush.color = drawingColorEl.value;
        canvas.freeDrawingBrush.width = parseInt(drawingLineWidthEl.value, 10) || 1;
        canvas.freeDrawingBrush.shadow = new fabric.Shadow({
            blur: parseInt(drawingShadowWidth.value, 10) || 0,
            offsetX: parseInt(drawingShadowOffset.value, 10) || 0,
            offsetY: parseInt(drawingShadowOffset.value, 10) || 0,
            affectStroke: true,
            color: drawingShadowColorEl.value,
        });
    } else {
        canvas.isDrawingMode = false;
    }
};

var currentDrawingColor;
drawingColorEl.oninput = function() {
    // if (canvas.isDrawingMode && canvas.freeDrawingBrush) {
        canvas.freeDrawingBrush.color = this.value;
    // }
};
drawingShadowColorEl.oninput = function() {
    if (canvas.isDrawingMode && canvas.freeDrawingBrush) {
        canvas.freeDrawingBrush.shadow.color = this.value;
    }
};
drawingLineWidthEl.onchange = function() {
    if (canvas.isDrawingMode && canvas.freeDrawingBrush) {
        canvas.freeDrawingBrush.width = parseInt(this.value, 10) || 1;
    }
};
drawingShadowWidth.onchange = function() {
    if (canvas.isDrawingMode && canvas.freeDrawingBrush) {
        canvas.freeDrawingBrush.shadow.blur = parseInt(this.value, 10) || 0;
    }
};
drawingShadowOffset.onchange = function() {
    if (canvas.isDrawingMode && canvas.freeDrawingBrush) {
        canvas.freeDrawingBrush.shadow.offsetX = parseInt(this.value, 10) || 0;
        canvas.freeDrawingBrush.shadow.offsetY = parseInt(this.value, 10) || 0;
    }
};
drawingModeEl.onclick = function() { toggleDrawingMode('free'); };

// Other functionalities can be added below as needed


///////////////////////////////////////////////////////////////////////////////////////////////////////////
var canvasHistory = [];
        
        
var currentIndex = -1;
        
        
function init(){
                canvasHistory =  localStorage.getItem('historyArray')? JSON.parse(localStorage.getItem('historyArray')) : [];
                currentIndex = localStorage.getItem('currentIndex')? JSON.parse(localStorage.getItem('currentIndex')) : -1;
                canvas.loadFromJSON(canvasHistory[currentIndex], function() {
                    canvas.renderAll();
                });
                const currentCanvasState = JSON.stringify(canvas.toJSON());

                console.log(currentIndex);
                console.log(JSON.parse(localStorage.getItem('historyArray')));
                // Check if the current state is different from the last saved state
                const lastSavedState = canvasHistory[currentIndex];
                if (currentCanvasState !== lastSavedState) {
                    // Remove any future states if they exist
                    canvasHistory = canvasHistory.slice(0, currentIndex + 1);
                    currentIndex++;
                    canvasHistory[currentIndex] = JSON.stringify(canvas.toJSON());
                    localStorage.setItem('historyArray', JSON.stringify(canvasHistory));
                    localStorage.setItem('currentIndex', JSON.stringify(currentIndex));
                    // Drop the oldest states until the history size is within the limit
                    while (canvasHistory.length > historySizeLimit) {
                        canvasHistory.shift();
                        currentIndex--;
                        if (currentIndex < 0) {
                            currentIndex = 0; // Ensures currentIndex doesn't go below 0
                        }
                    }
                }
}

// Function to save the current canvas state to history
function saveToHistory() {

            if (!isUndoRedoOperation) {
                const currentCanvasState = JSON.stringify(canvas.toJSON());
                // Check if the current state is different from the last saved state
                const lastSavedState = canvasHistory[currentIndex];
                if (currentCanvasState !== lastSavedState) {
                    // Remove any future states if they exist
                    canvasHistory = canvasHistory.slice(0, currentIndex + 1);
                    currentIndex++;
                    canvasHistory[currentIndex] = JSON.stringify(canvas.toJSON());
                    localStorage.setItem('historyArray', JSON.stringify(canvasHistory));
                    localStorage.setItem('currentIndex', JSON.stringify(currentIndex));
                    // Drop the oldest states until the history size is within the limit
                    while (canvasHistory.length > historySizeLimit) {
                        canvasHistory.shift();
                        currentIndex--;
                        if (currentIndex < 0) {
                            currentIndex = 0; // Ensures currentIndex doesn't go below 0
                        }
                    }
                }
            }
        }

        // Fabric.js events to detect changes
        canvas.on('object:modified', saveToHistory);
        canvas.on('object:added', saveToHistory);
        const menu = document.querySelector("#context-menu");
        fabric.util.addListener(document.getElementsByClassName('upper-canvas')[0], 'contextmenu', function(e) {
            checkGroupedObjects();
            var cnvsPos = $('#canvas-container').offset();
            curX = e.clientX  - 50;
            console.log(curX,cnvsPos.left);
            curY = e.clientY - cnvsPos.top/2 - 20;
            console.log(curY,cnvsPos.top);
            // curX = e.clientX - menu.offsetWidth/2;
            // curY = e.clientY - menu.offsetHeight - 10;
            $('#context-menu').css({'top': curY, 'left': curX}).fadeIn('fast');
            //console.log("Position of the cursor point" + curX + "," + curY);
        });
        $(document).click(function(event) {
        if (!$(event.target).closest('#context-menu').length) {
            if ($('#context-menu').css("display", "flex")) {
                $('#context-menu').css("display", "none");
            }
        }
        });


        $(document).on('click', '#group', function(evt) {
            $('#context-menu').hide();
            console.log(isGrouped);
            if (isGrouped) {
                canvas.getActiveObject().toActiveSelection();
                canvas.requestRenderAll();
                isGrouped = false;
            } else {
                canvas.getActiveObject().toGroup();
                canvas.requestRenderAll();
            }
        });

        document.getElementById("undo").addEventListener("click", undo);
        function undo() {
            if (currentIndex > 0) {
                isUndoRedoOperation = true;
                currentIndex--;
                const previousState = canvasHistory[currentIndex];
                canvas.loadFromJSON(previousState, function() {
                    canvas.renderAll();
                    isUndoRedoOperation = false;
                });
            }
        }

        document.getElementById("redo").addEventListener("click", redo);
        function redo() {
            if (currentIndex < canvasHistory.length - 1) {
                isUndoRedoOperation = true;
                currentIndex++;
                const nextState = canvasHistory[currentIndex];
                canvas.loadFromJSON(nextState, function() {
                    canvas.renderAll();
                    isUndoRedoOperation = false;
                });
            }
        }

        document.getElementById("clear").addEventListener("click", function () {
            canvas.clear();
            console.log(canvasHistory[currentIndex]);
            // canvas.setBackgroundColor('white', canvas.renderAll.bind(canvas));
            saveToHistory();
        });


        // Save initial state

        init()

        console.log(canvasHistory[currentIndex])

        updatePasteButtonVisibility();


        document.addEventListener('keydown', function(event) {
            // Check if the Ctrl key is pressed (Ctrl key has key code 17)
            if (event.ctrlKey || event.metaKey) {
                // Check for Ctrl+Z (undo) on Windows or Command+Z on Mac
                if ((event.key === 'z' || event.key === 'Z') && !event.shiftKey) {
                    event.preventDefault(); // Prevent the browser's default Ctrl+Z or Command+Z behavior
                    undo(); // Call the undo function
                }
                // Check for Ctrl+R (redo) on Windows or Command+R on Mac
                else if ((event.key === 'r' || event.key === 'R') && !event.shiftKey) {
                    event.preventDefault(); // Prevent the browser's default Ctrl+R or Command+R behavior
                    redo(); // Call the redo function
                }
            }
        });


        // Function to remove the selected object
        function removeSelectedObject() {
            var activeObject = canvas.getActiveObject();

            if (activeObject) {
                // Check if the selection is a group of objects
                if (activeObject.type === 'activeSelection') {
                    activeObject.forEachObject(function(obj) {
                        canvas.remove(obj);
                    });
                    // Deselect the group after removing its objects
                    canvas.discardActiveObject();
                } else {
                    // If it's a single object, just remove it
                    canvas.remove(activeObject);
                }
                canvas.requestRenderAll();
                saveToHistory();
            }
        }



        $("#save").on("click", function(e) {
                    $(".save").html(canvas.toSVG());
        });


        function checkGroupedObjects() {
            let group = document.getElementById("group");
            let activeObject = canvas.getActiveObject();
            // Check if there is an active object
            if (activeObject) {
                // Check if the active object is a group
                console.log(activeObject.type);
                if (activeObject && activeObject.type === 'group') {
                    group.style.display = "flex";
                    group.textContent = "Ungroup";
                    isGrouped = true;
                } else {
                    group.style.display = "flex";
                    group.textContent = "Group";
                    isGrouped = false;
                }
            } else {
                // Default text or action when no object is selected
                    group.style.display = "none";
            }
        }

//     canvas.on('object:moved', function(e) {
//         console.log('Object moved');
//     });
// $("#text").on("click", function(e) {
// text = new fabric.Text($("#text").val(), { left: 100, top: 100 });
// 	  canvas.add(text);
// });
// $("#rect").on("click", function(e) {
//   	rect = new fabric.Rect({
//     left: 40,
//     top: 40,
//     width: 50,
//     height: 50,      
//     fill: 'transparent',
//     stroke: 'green',
//     strokeWidth: 5,
// 			  });  
//   canvas.add(rect);
// });

// $("#circ").on("click", function(e) {
//   	rect = new fabric.Circle({
//     left: 40,
//     top: 40,
//     radius: 50,     
//     fill: 'transparent',
//     stroke: 'green',
//     strokeWidth: 5,
// 			  });  
//   canvas.add(rect);
// });

// $("#save").on("click", function(e) {
//   	$(".save").html(canvas.toSVG());
// });

// text mode
var isTextMode = false;
var placeholderText = 'Edit me'; // Placeholder text

// Toggle text adding mode and change cursor
document.getElementById('add-text').addEventListener('click', function() {
    isTextMode = !isTextMode;
    canvas.defaultCursor = isTextMode ? 'text' : 'default';
    canvas.renderAll(); // Re-render the canvas to apply the cursor change
});

// Add a text box at the click position and revert cursor
canvas.on('mouse:down', function(options) {
    if (isTextMode) {
        var pointer = canvas.getPointer(options.e);
        var text = new fabric.IText(placeholderText, {
            left: pointer.x,
            top: pointer.y,
            fontFamily: 'Titillium Web',
            fill: 'black',
            fontStyle: 'italic',
            fontSize: 23,
            opacity: 0.5
        });

        text.on('editing:entered', function() {
            if (this.text === placeholderText) {
                this.text = '';
                this.opacity = 1; // Reset opacity
                this.fontStyle = 'normal'; // Reset font style
            }
        });

        text.on('editing:exited', function() {
            if (this.text === '') {
                this.text = placeholderText;
                this.opacity = 0.5; // Apply transparency
                this.fontStyle = 'italic'; // Apply italic font style
            }

            // Update cursor after editing is exited
            isTextMode = false;
            canvas.defaultCursor = 'default';
            canvas.renderAll();
        });

        canvas.add(text);
        canvas.setActiveObject(text);
        text.enterEditing();
        text.selectAll();

        isTextMode = false; // Turn off text mode after adding the text box
        canvas.defaultCursor = 'default'; // Set the cursor back to default
        canvas.renderAll(); // Re-render the canvas to apply the cursor change
    }
});

//         // Binding the Backspace key to remove the selected object
//         document.addEventListener('keydown', function(event) {
//     console.log(isTextMode);
//     if ((event.key === 'Backspace' || event.key === 'Delete') && !isTextMode) {
//         event.preventDefault(); // Prevent the default backspace action
//         removeSelectedObject(); // Remove the selected object
//     }
//     // If isTextMode is true, the default behavior (editing text) will occur
// });



</script>
<script>
    document.addEventListener('DOMContentLoaded', function() {
    document.querySelector('#theme-toggle').addEventListener('click', function() {
        document.body.classList.toggle('light-theme');
        var sunIcon = document.getElementById('sun');
        var moonIcon = document.getElementById('moon');
        sunIcon.style.display = sunIcon.style.display === 'none' ? 'block' : 'none';
        moonIcon.style.display = moonIcon.style.display === 'none' ? 'block' : 'none';
    });
});
function resizeCanvas() {
var container = document.getElementById('canvas-container');

canvas.width = container.clientWidth;
canvas.height = container.clientHeight;
}
// Adjust canvas size when the window is resized
window.addEventListener('resize', resizeCanvas);

// Initial adjustment
resizeCanvas();

document.querySelectorAll('.nav-link').forEach(link => {
    link.addEventListener('mouseenter', (e) => {
        const hoverBg = link.querySelector('.hover-bg');
        const rect = link.getBoundingClientRect();
        const x = e.clientX - rect.left; // x position within the element.
        hoverBg.style.transformOrigin = x < rect.width / 2 ? 'left' : 'right';
        hoverBg.style.transform = 'scaleX(1)';
    });

    link.addEventListener('mouseleave', (e) => {
        const hoverBg = link.querySelector('.hover-bg');
        const rect = link.getBoundingClientRect();
        const x = e.clientX - rect.left; // x position within the element.
        hoverBg.style.transformOrigin = x < rect.width / 2 ? 'left' : 'right';
        hoverBg.style.transform = 'scaleX(0)';
    });
});



// var dataPoints = [
//     { x: 10, y: 50 }, 
//     { x: 50, y: 30 },
//     { x: 90, y: 70 },
//     // Add more points as needed
// ];

// // Function to draw a line between two points
// function drawLine(point1, point2) {
//     var line = new fabric.Line([point1.x, point1.y, point2.x, point2.y], {
//         fill: 'black',
//         stroke: 'black',
//         strokeWidth: 2,
//     });
//     canvas.add(line);
// }

// // Draw the line plot
// for (var i = 0; i < dataPoints.length - 1; i++) {
//     drawLine(dataPoints[i], dataPoints[i + 1]);
// }
</script>

</body>
</html>